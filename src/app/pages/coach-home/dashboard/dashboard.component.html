<div class="dashboard-container">
    <div *ngIf="isLoading" class="loading-state">
        <ion-spinner color="primary"></ion-spinner>
    </div>

    <div *ngIf="!isLoading">
        <!-- Main Stats Row -->
        <div class="stats-grid">
            <div class="stat-card glass-panel">
                <ion-icon name="people-outline" color="primary"></ion-icon>
                <div class="stat-content">
                    <span class="stat-label">Total Athletes</span>
                    <span class="stat-value">{{ stats.athleteCount }}</span>
                </div>
            </div>

            <div class="stat-card glass-panel">
                <ion-icon name="document-text-outline" color="secondary"></ion-icon>
                <div class="stat-content">
                    <span class="stat-label">Active Plans</span>
                    <span class="stat-value">{{ stats.planCount }}</span>
                </div>
            </div>

            <div class="stat-card glass-panel highlight">
                <div class="radial-progress-container">
                    <span class="completion-value">{{ completionRate | number:'1.0-0' }}%</span>
                </div>
                <div class="stat-content">
                    <span class="stat-label">Completion today</span>
                    <span class="stat-value">{{ stats.completedTodayCount }} logged</span>
                </div>
            </div>
        </div>

        <!-- Analytics Charts -->
        <div class="analytics-row">
            <div class="chart-container glass-panel">
                <div class="chart-header">
                    <h3>Volume Trends</h3>
                    <p>Total kg moved by all athletes (Last 14 days)</p>
                </div>
                <div class="chart-wrapper">
                    <canvas #volumeChart></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Activity Feed -->
        <div class="activity-section">
            <h3 class="section-title">Recent Activity</h3>
            <div *ngIf="stats.recentActivity.length === 0" class="empty-activity glass-panel">
                <p>No recent workout activity recorded.</p>
            </div>
            <div class="activity-feed">
                <div *ngFor="let activity of stats.recentActivity" class="activity-item glass-panel">
                    <div class="activity-header">
                        <ion-avatar>
                            <div class="avatar-placeholder">{{ activity.athleteId?.email?.[0]?.toUpperCase() }}</div>
                        </ion-avatar>
                        <div class="activity-main">
                            <span class="athlete-email">{{ activity.athleteId?.email }}</span>
                            <span class="workout-name">{{ activity.workoutPlanId?.name || 'Workout' }}</span>
                        </div>
                        <ion-badge [color]="getFeedbackColor(activity.feedbackColor)">
                            {{ activity.feedbackColor }}
                        </ion-badge>
                    </div>
                    <div class="activity-footer">
                        <span class="activity-date">{{ activity.date | date:'shortTime' }} â€¢ {{ activity.date |
                            date:'mediumDate' }}</span>
                        <span class="activity-volume">{{ activity.totalVolume || 0 }} kg total</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>